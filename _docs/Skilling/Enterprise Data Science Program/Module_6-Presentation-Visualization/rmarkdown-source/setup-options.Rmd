```{r main-setup, include=FALSE}
options(
  htmltools.dir.version = FALSE,
  dplyr.print_min = 6,
  dplyr.print_max = 6,
  tibble.width = 65,
  width = 65,
  htmltools.preserve.raw = FALSE # Needed for JS-based renders
)

knitr::opts_chunk$set(
  echo = TRUE,
  fig.width = 8,
  fig.asp = 0.618, # Golden ratio
  #out.width = "60%",
  fig.align = "center",
  dpi = 300,
  message = FALSE,
  warning = FALSE,
  fig.retina = 2
)

# ggplot2
ggplot2::theme_set(ggplot2::theme_gray(base_size = 16))

# set seed
set.seed(1234)

# fontawesome
htmltools::tagList(rmarkdown::html_dependency_font_awesome())
# remotes::install_github("mitchelloharawild/icons")
library(icons)
# download_fontawesome()
# download_academicons()
# download_simple_icons()

# magick
dev.off <- function() {
  invisible(grDevices::dev.off())
}

# conflicted
library(conflicted)
conflict_prefer("filter", "dplyr")



library(tibble, quietly = T, warn.conflicts = F)
library(dplyr, quietly = T, warn.conflicts = F)
library(stringr, quietly = T, warn.conflicts = F)
library(ggplot2, quietly = T, warn.conflicts = F)
library(kableExtra, quietly = T, warn.conflicts = F)
library(tidyverse, quietly = T, warn.conflicts = F)

# output number of lines
hook_output <- knitr::knit_hooks$get("output")
knitr::knit_hooks$set(
  output = function(x, options) {
    lines <- options$output.lines
    if (is.null(lines)) {
      return(hook_output(x, options)) # pass to default hook
    }
    x <- unlist(strsplit(x, "\n"))
    more <- "..."
    if (length(lines) == 1) {
      # first n lines
      if (length(x) > lines) {
        # truncate the output, but add ....
        x <- c(head(x, lines), more)
      }
    } else {
      x <- c(more, x[lines], more)
    }
    # paste these lines together
    x <- paste(c(x, ""), collapse = "\n")
    hook_output(x, options)
  }
)
```

```{r, echo=FALSE}
# xaringanExtra
library(xaringanExtra)
xaringanExtra::use_panelset()
xaringanExtra::use_tachyons()
# xaringanExtra::use_scribble()
# xaringanExtra::use_share_again()

xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,
  mute_unhighlighted_code = TRUE
)
```

```{css echo=F}
# This section removes all the external social media links from the share bar
# created by xaringanExtra::use_share_again()
.shareagain-bar{
  --shareagain-foreground: rgb(255, 255, 255);
  --shareagain-background: rgba(0, 0, 0, 0.5);
  --shareagain-twitter: none;
  --shareagain-facebook: none;
  --shareagain-linkedin: none;
  --shareagain-pinterest: none;
  --shareagain-pocket: none;
  --shareagain-reddit: none;
}
```

```{r paths, include=F}
library(fs, quietly = T, warn.conflicts = F)
library(here, quietly = T, warn.conflicts = F)
# paths
deploy_path <- here::here("public-website")
rel_path <- function(d) fs::path_rel(d, here::here())

# img_path <- function(f) {
#   path(path_rel(imgdir,currdir), f)
# }
img_path <- function(f){
  path("img", f)
  }

img_insert <- function(f, scale = FALSE) {
  img_html <- paste0('<img src="', img_path(f), '"')
  if (is.numeric(scale)) {
    img_html <- paste0(img_html, ' width="', scale, '%"')
  }
  img_html <- paste0(img_html, "/>")
  return(img_html)
}
```
